# üîí SECURITY & SECRETS MANAGEMENT

**Project:** FK Webstack  
**Date:** February 1, 2026  
**Status:** ‚úÖ Secrets properly managed

---

## ‚ö†Ô∏è Important: This Project NEVER Exposes Secrets in Git

Unlike the original project (which had exposed token `egvgyj.ks2yu2d82jalzgdq`), this clean version follows security best practices:

---

## üìã What We Protect

### **1. MongoDB Credentials**
- **Location:** docker-compose.yaml (local testing only)
- **Protection:** Use `docker-compose.override.yml` (in .gitignore)
- **In Kubernetes:** Use Secrets resource (not in manifests)
- **Status:** ‚úÖ docker-compose has placeholder values

### **2. Kubernetes Join Token**
- **Location:** Auto-generated by kubeadm on each cluster
- **Protection:** Stored in `/vagrant/kubeadm-config/` (in .gitignore)
- **Why:** Token is one-time use, cluster-specific, and expires
- **Status:** ‚úÖ .gitignore prevents accidental commit

### **3. TLS/SSL Certificates**
- **cert-manager:** Generates self-signed certs (acceptable for school project)
- **Protection:** Stored as Kubernetes Secrets (secure)
- **Git:** Never commit actual certificates
- **Status:** ‚úÖ ROADMAP creates via kubectl (not in git)

### **4. ArgoCD Admin Password**
- **Generation:** Auto-generated by Helm on install
- **Protection:** Stored as Kubernetes Secret
- **Git:** Retrieved via `kubectl` command (not in git)
- **Status:** ‚úÖ ROADMAP shows how to retrieve safely

### **5. API Keys / Database URLs**
- **Location:** Kubernetes ConfigMaps and Secrets (not in source code)
- **Protection:** Use environment variables
- **Git:** Never hardcode in manifests or code
- **Status:** ‚úÖ Properly separated in containers/api/app/main.py

---

## ‚úÖ Files Protected by .gitignore

```
vagrant/kubeadm-config/join-command.sh      # One-time cluster token
docker-compose.override.yml                  # Local credentials
.env                                         # Environment variables
.env.local                                   # Local-specific config
*-secret*.yaml                               # Secret manifests
*.key                                        # Private keys
*.pem                                        # Certificates
```

---

## üîê How Secrets Are Managed

### **Local Development (docker-compose)**

**‚ùå DON'T:**
```yaml
# docker-compose.yaml - WRONG!
environment:
  MONGO_PASSWORD: "MySecretPassword"  # EXPOSED IN GIT!
```

**‚úÖ DO:**
```yaml
# docker-compose.yaml - CORRECT
environment:
  MONGO_PASSWORD: password  # Placeholder for docker-compose.override.yml
```

Then create `docker-compose.override.yml`:
```yaml
# docker-compose.override.yml (in .gitignore)
services:
  fk-mongodb:
    environment:
      MONGO_PASSWORD: YourActualPassword
```

### **Kubernetes Deployment**

**‚ùå DON'T:**
```yaml
# manifests.yaml - WRONG!
env:
  - name: MONGO_PASSWORD
    value: "MySecretPassword"  # EXPOSED IN GIT!
```

**‚úÖ DO:**
```yaml
# manifests.yaml - CORRECT
env:
  - name: MONGO_PASSWORD
    valueFrom:
      secretKeyRef:
        name: mongo-credentials
        key: password
```

Then create the Secret:
```bash
kubectl create secret generic mongo-credentials \
  --from-literal=password=YourActualPassword \
  -n fk-webstack
```

---

## üõ°Ô∏è Best Practices This Project Follows

1. **No Secrets in Code**
   - ‚úÖ All credentials in environment variables
   - ‚úÖ All connection strings from ConfigMaps/Secrets

2. **No Secrets in Git**
   - ‚úÖ Comprehensive .gitignore
   - ‚úÖ Example files provided (*.example, *.template)
   - ‚úÖ Never commit .env files

3. **Kubernetes Secrets**
   - ‚úÖ Use native Kubernetes Secret resources
   - ‚úÖ Base64 encoded (not encrypted in default K8s, but separated from code)
   - ‚úÖ Can use sealed-secrets or vault for encryption (optional)

4. **Git History**
   - ‚úÖ No sensitive data in past commits
   - ‚úÖ Clean history from start
   - ‚úÖ No need for credential cleanup

5. **Documentation**
   - ‚úÖ Shows how to manage secrets safely
   - ‚úÖ Examples use placeholder values
   - ‚úÖ This file explains each secret type

---

## üìö Secret Types in This Project

| Secret | Type | Storage | Git Safe? | Notes |
|--------|------|---------|-----------|-------|
| MongoDB password | Credential | K8s Secret | ‚úÖ Yes | Uses environment override |
| kubeadm join token | Token | /vagrant/ (gitignore) | ‚úÖ Yes | One-time use, auto-generated |
| TLS certificate | Certificate | K8s Secret | ‚úÖ Yes | Generated by cert-manager |
| ArgoCD password | Credential | K8s Secret | ‚úÖ Yes | Auto-generated, retrieved via kubectl |
| API Database URL | Configuration | ConfigMap | ‚úÖ Yes | Non-sensitive URL only |

---

## üö® If Secrets Were Accidentally Exposed

**DO NOT:** Simply delete from current commit - it's still in git history!

**DO THIS:**

1. **Revoke the secret immediately**
   - Kubernetes token: Generate new one
   - Password: Change it everywhere
   - Certificate: Revoke and regenerate

2. **Clean git history:**
   ```bash
   # Option A: Git filter-branch (advanced)
   git filter-branch --tree-filter 'rm -f sensitive-file.txt' HEAD

   # Option B: BFG repo-cleaner (recommended)
   bfg --delete-files sensitive-file.txt
   git reflog expire --expire=now --all
   git gc --prune=now --aggressive
   ```

3. **Force push to GitHub:**
   ```bash
   git push origin --force --all
   ```

4. **Notify collaborators**
   - Tell them to pull latest
   - Pull fresh clones instead of updating old ones

---

## ‚ú® This Project's Security Status

‚úÖ **No exposed credentials in git history**  
‚úÖ **Comprehensive .gitignore**  
‚úÖ **Example files for safe setup**  
‚úÖ **Kubernetes Secrets for production data**  
‚úÖ **Environment variables for configuration**  
‚úÖ **Documentation of best practices**  

---

## üîó References

- [Kubernetes Secrets Documentation](https://kubernetes.io/docs/concepts/configuration/secret/)
- [Docker Secrets Best Practices](https://docs.docker.com/develop/security/)
- [OWASP Secrets Management](https://owasp.org/www-community/Sensitive_Data_Exposure)
- [Git Security Best Practices](https://git-scm.com/book/en/v2/Git-Tools-Credential-Storage)

---

**Last Reviewed:** February 1, 2026  
**Status:** ‚úÖ Secure by design
